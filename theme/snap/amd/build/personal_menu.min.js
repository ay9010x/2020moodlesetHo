define(["jquery","core/log","core/yui","theme_snap/pm_course_cards","theme_snap/util","theme_snap/ajax_notification"],function(a,b,c,d,e,f){var g=function(){var g=this;this.update=function(){d.reqCourseInfo(d.getCourseIds()),a("#primary-nav").focus(),a("#page, #moodle-footer, #js-personal-menu-trigger, #logo, .skiplinks").hide(0);var g=function(c){var d=a("#snap-personal-menu-"+c);if(a(d).length){var g=M.cfg.sesskey+"personal-menu-"+c;try{if(e.supportsSessionStorage()&&window.sessionStorage[g]){b.info("using locally stored "+c);var h=window.sessionStorage[g];a(d).html(h)}b.info("fetching "+c),a.ajax({type:"GET",async:!0,url:M.cfg.wwwroot+"/theme/snap/rest.php?action=get_"+c+"&contextid="+M.cfg.context,success:function(h){f.ifErrorShowBestMsg(h)||(b.info("fetched "+c),e.supportsSessionStorage()&&"undefined"!=typeof h.html&&(window.sessionStorage[g]=h.html),a(d).attr("data-content-loaded","1"),a(d).html(h.html))}})}catch(i){sessionStorage.clear(),b.error(i)}}};g("deadlines"),g("graded"),g("grading"),g("messages"),g("forumposts"),a("#snap-personal-menu-badges").length&&("undefined"==typeof M.snap_message_badge?e.whenTrue(function(){return"undefined"!=typeof M.snap_message_badge},function(){M.snap_message_badge.init_overlay(c)},!0):M.snap_message_badge.init_overlay(c)),a(document).trigger("snapUpdatePersonalMenu")};var h=function(){a(document).on("click",".js-personal-menu-trigger",function(b){a("body").toggleClass("snap-fixy-open"),a(".snap-fixy-open #primary-nav").is(":visible")&&g.update(),b.preventDefault()}),a(document).on("click","#fixy-mobile-menu a",function(b){var c=this.getAttribute("href"),d=a("#fixy-content section"),e=a(d).outerWidth(),f=a(c),g=a(".callstoaction section > div").index(f)+1,h=e*g,i=a(c).outerHeight()+100;"#fixy-my-courses"==c&&(h=0);var j=a(window).height();j>i&&(i=j),a("#fixy-content").animate({left:"-"+h+"px",height:i+"px"},"fast","swing",function(){}),b.preventDefault()}),a(document).on("click","#fixy-close",function(){a("#page, #moodle-footer, #js-personal-menu-trigger, #logo, .skiplinks").css("display","")})};this.init=function(){h(),d.init()}};return new g});