define(["jquery","theme_snap/util","theme_snap/responsive_video","theme_snap/section_asset_management","theme_snap/course_modules"],function(a,b,c,d,e){return function(f){var g=this;g.courseConfig=f;var h=function(){return 0===a("body").attr("id").indexOf("page-course-view-")},i=function(c){a("#toc-search-results").html("");var d=a("#"+c.replace("#",""));b.scrollToElement(d);var e=a("#searchpin");e.length||(e=a('<i id="searchpin"></i>')),a(d).find(".instancename").prepend(e),a(d).attr("tabindex","-1").focus()};this.setTOCVisibleSection=function(){var b=".section.main.state-visible, #coursetools.state-visible, #snap-add-new-section.state-visible",c=a(b).attr("id");a("#chapters li").removeClass("snap-visible-section"),a('#chapters a[href$="'+c+'"]').parent("li").addClass("snap-visible-section")},this.showSection=function(){if(h()){var b="";a(".section.main.state-visible.set-by-server").length?(b="#"+a(".section.main.state-visible.set-by-server").attr("id"),a(".section.main.state-visible.set-by-server").removeClass("set-by-server")):a(".course-content .section.main, #moodle-blocks,#coursetools, #snap-add-new-section").removeClass("state-visible");var d=location.hash.split("&"),e=d[0],f=d[1]||null;""!==e&&e!==b&&a(b).removeClass("state-visible"),"#coursetools"==e&&a("#moodle-blocks").addClass("state-visible"),null!==f?(a(e).addClass("state-visible"),i(f)):(a(e).addClass("state-visible").focus(),window.scrollTo(0,0));var g=a(".section.main.state-visible,#coursetools.state-visible,#snap-add-new-section.state-visible");g.length||(a(".section.main.current").length?a(".section.main.current").addClass("state-visible").focus():a("#section-0").addClass("state-visible").focus(),window.scrollTo(0,0)),c.apply(),this.setTOCVisibleSection()}};var j=function(){d.init(g),e.init(),g.courseConfig.enablecompletion&&require(["theme_snap/course_conditionals-lazy"],function(a){a(f)}),h()&&(g.showSection(),a(document).on("snapTOCReplaced",function(){g.setTOCVisibleSection()}))};j()}});