define(["core/notification","core/ajax","core/templates","core/str"],function(a,b,c,d){var e=!1,f=!1;return $(document).ready(function(){$("#fixy-logout").click(function(){f=!0})}),{ifErrorShowBestMsg:function(b,g,h){if(e)return!0;if(f)return!1;if("object"!=typeof b)try{var i=JSON.parse(b);b=i}catch(j){}if("undefined"==typeof b&&(b={error:M.util.get_string("unknownerror","core")}),b.error||b.errorcode){if(M.snapTheme.forcePassChange){var k=M.cfg.wwwroot+"/login/change_password.php";return $("#fixy-content").length&&(d.get_string("forcepwdwarningpersonalmenu","theme_snap",k).done(function(a){var b={message:a,extraclasses:"force-pwd-warning"};c.render("core/notification_warning",b).done(function(a){$("#fixy-content").html("<br />"+a)})}),$("#fixy-content").is(":visible"))?!0:window.location.href.indexOf("login/change_password.php")>-1?!0:(window.location=k,e=!0,!0)}var l=function(b){if(h)a.alert(M.util.get_string("error","moodle"),h,M.util.get_string("ok","moodle"));else if(b.backtrace)a.exception(b);else{var c;b.error?(c=b.error,b.stacktrace&&(c="<div>"+c+"<pre>"+b.stacktrace+"</pre></div>")):c=b.errorcode&&b.message?b.message:M.util.get_string("unknownerror","moodle"),a.alert(M.util.get_string("error","moodle"),c,M.util.get_string("ok","moodle"))}};return g=g?g:"",$.ajax({type:"POST",async:!0,data:{sesskey:M.cfg.sesskey,failedactionmsg:g},url:M.cfg.wwwroot+"/theme/snap/rest.php?action=get_loginstatus"}).done(function(c){return e?!0:void(c.loggedin?(console.log(b),l(b)):($("<style>.confirmation-dialogue .confirmation-buttons input:nth-of-type(2), .moodle-dialogue-base.moodle-dialogue-confirm button.yui3-button.closebutton{ display : none }</style>").appendTo("head"),a.confirm(c.loggedouttitle,c.loggedoutmsg,c.loggedoutcontinue," ",function(){window.location=M.cfg.wwwroot+"/login/index.php"}),e=!0))}),!0}return!1}}});